

clear all
set mem 1g

capture cd "C:\Users\Horacio\Dropbox\Incumbency Advantage\Precinct\Puebla - 1998, 2001, 2004, 2007, 2010,  2013"

import excel "Coaliciones_2013.xlsx", sheet("Sheet1") firstrow clear
drop DISTRITO PROPIETARIO SUPLENTE
drop if MUNICIPIO=="MUNICIPIO"
drop if MUNICIPIO=="" & PARTIDOCOALICINOCANDIDATURA=="" 
drop if strpos(PARTIDOCOALICINOCANDIDATURA, "PARTIDO,COALICIÓN  O")>0
drop if strpos(PARTIDOCOALICINOCANDIDATURA, "CANDIDATURA  COMÚN")>0
drop if  PARTIDOCOALICINOCANDIDATURA=="Ó Í"

count if CARGO == "PRESIDENTE" & CARGO[_n+1] =="REGIDOR  2"
replace PARTIDOCOALICINOCANDIDATURA = PARTIDOCOALICINOCANDIDATURA + " " + PARTIDOCOALICINOCANDIDATURA[_n+1] if CARGO == "PRESIDENTE" & CARGO[_n+1] =="REGIDOR  2"
drop if CARGO[_n-1] == "PRESIDENTE" & CARGO =="REGIDOR  2"

count if CARGO == "PRESIDENTE" & CARGO[_n+1] =="REGIDOR  3"
replace PARTIDOCOALICINOCANDIDATURA = PARTIDOCOALICINOCANDIDATURA + " " + PARTIDOCOALICINOCANDIDATURA[_n+1] if CARGO == "PRESIDENTE" & CARGO[_n+1] =="REGIDOR  3"
drop if CARGO[_n-1] == "PRESIDENTE" & CARGO =="REGIDOR  3"

tab CARGO
drop CARGO

replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PACTO  SOCIAL  DE  INTEGRACIÓN,  PARTIDO POLÍTICO", "PSI", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PACTO  SOCIAL  DE INTEGRACIÓN,  PARTIDO  POLÍTICO", "PSI", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PACTO  SOCIAL DE  INTEGRACIÓN,  PARTIDO  POLÍTICO", "PSI", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "COALICIÓN  PUEBLA  UNIDA", "PAN_PRD_PANAL_CPP", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "COALICIÓN  5  DE  MAYO", "PRI_PVEM", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PARTIDO  DEL  TRABAJO", "PT", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "MOVIMIENTO  CIUDADANO", "PC", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "MOVIMIENTO CIUDADANO", "PC", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "  ", " ", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PARTIDO DEL TRABAJO", "PT", .)
replace PARTIDOCOALICINOCANDIDATURA = subinstr(PARTIDOCOALICINOCANDIDATURA, "PACTO SOCIAL DE INTEGRACIÓN, PARTIDO POLÍTICO", "PSI", .)	
replace PARTIDOCOALICINOCANDIDATURA = trim(PARTIDOCOALICINOCANDIDATURA)
compress PARTIDOCOALICINOCANDIDATURA

replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PC, PSI" if PARTIDOCOALICINOCANDIDATURA == "PC,PSI, PAN_PRD_PANAL_CPP"
replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PC, PSI" if PARTIDOCOALICINOCANDIDATURA == "PSI,PC,PAN_PRD_PANAL_CPP,"
replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PC, PSI" if PARTIDOCOALICINOCANDIDATURA == "PSI, PC, PAN_PRD_PANAL_CPP"
replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PSI" if PARTIDOCOALICINOCANDIDATURA == "PSI, PAN_PRD_PANAL_CPP"
replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PT, PSI" if PARTIDOCOALICINOCANDIDATURA == "PAN_PRD_PANAL_CPP, PTPSI,"
replace PARTIDOCOALICINOCANDIDATURA ="PAN_PRD_PANAL_CPP, PT, PSI" if PARTIDOCOALICINOCANDIDATURA == "PT, PSI, PAN_PRD_PANAL_CPP"

replace MUNICIPIO = MUNICIPIO[_n-1] if MUNICIPIO =="" &  MUNICIPIO[_n-1]!=""

keep if strpos(PARTIDOCOALICINOCANDIDATURA, ",")>0

rename MUNICIPIO municipality
replace municipality = subinstr(municipality, "Á", "a", .)
replace municipality = subinstr(municipality, "É", "e", .)
replace municipality = subinstr(municipality, "Í", "i", .)
replace municipality = subinstr(municipality, "Ó", "o", .)
replace municipality = subinstr(municipality, "ú", "u", .)
replace municipality = subinstr(municipality, "Ñ", "n", .)
replace municipality = subinstr(municipality, "  ", " ", .)
replace municipality = proper(municipality)

replace municipality ="La Magdalena Tlatlauquitepec" if municipality=="La Magdalena"
replace municipality ="San Diego La Mesa Tochimiltzingo" if municipality=="San Diego La Mesa Tochimitzingo"
replace municipality ="San Matias Tlalancaleca" if municipality=="San Matias"
						 
rename PARTIDOCOALICINOCANDIDATURA coalicion

* replace municipality ="Albino Zertuche" if municipality =="Albino  Zertuche"

save Coaliciones_2013.dta, replace

